"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const D=(e,n)=>n.some(t=>e instanceof t);let w,E;function x(){return w||(w=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function V(){return E||(E=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const y=new WeakMap,g=new WeakMap,l=new WeakMap;function j(e){const n=new Promise((t,r)=>{const i=()=>{e.removeEventListener("success",c),e.removeEventListener("error",o)},c=()=>{t(d(e.result)),i()},o=()=>{r(e.error),i()};e.addEventListener("success",c),e.addEventListener("error",o)});return l.set(n,e),n}function O(e){if(y.has(e))return;const n=new Promise((t,r)=>{const i=()=>{e.removeEventListener("complete",c),e.removeEventListener("error",o),e.removeEventListener("abort",o)},c=()=>{t(),i()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",c),e.addEventListener("error",o),e.addEventListener("abort",o)});y.set(e,n)}let I={get(e,n,t){if(e instanceof IDBTransaction){if(n==="done")return y.get(e);if(n==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return d(e[n])},set(e,n,t){return e[n]=t,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function L(e){I=e(I)}function T(e){return V().includes(e)?function(...n){return e.apply(h(this),n),d(this.request)}:function(...n){return d(e.apply(h(this),n))}}function A(e){return typeof e=="function"?T(e):(e instanceof IDBTransaction&&O(e),D(e,x())?new Proxy(e,I):e)}function d(e){if(e instanceof IDBRequest)return j(e);if(g.has(e))return g.get(e);const n=A(e);return n!==e&&(g.set(e,n),l.set(n,e)),n}const h=e=>l.get(e);function v(e,n,{blocked:t,upgrade:r,blocking:i,terminated:c}={}){const o=indexedDB.open(e,n),a=d(o);return r&&o.addEventListener("upgradeneeded",s=>{r(d(o.result),s.oldVersion,s.newVersion,d(o.transaction),s)}),t&&o.addEventListener("blocked",s=>t(s.oldVersion,s.newVersion,s)),a.then(s=>{c&&s.addEventListener("close",()=>c()),i&&s.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const N=["get","getKey","getAll","getAllKeys","count"],W=["put","add","delete","clear"],m=new Map;function P(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(m.get(n))return m.get(n);const t=n.replace(/FromIndex$/,""),r=n!==t,i=W.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||N.includes(t)))return;const c=async function(o,...a){const s=this.transaction(o,i?"readwrite":"readonly");let u=s.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),i&&s.done]))[0]};return m.set(n,c),c}L(e=>({...e,get:(n,t,r)=>P(n,t)||e.get(n,t,r),has:(n,t)=>!!P(n,t)||e.has(n,t)}));const F=["continue","continuePrimaryKey","advance"],M={},B=new WeakMap,C=new WeakMap,k={get(e,n){if(!F.includes(n))return e[n];let t=M[n];return t||(t=M[n]=function(...r){B.set(this,C.get(this)[n](...r))}),t}};async function*K(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;n=n;const t=new Proxy(n,k);for(C.set(t,n),l.set(t,h(n));n;)yield t,n=await(B.get(t)||n.continue()),B.delete(t)}function p(e,n){return n===Symbol.asyncIterator&&D(e,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&D(e,[IDBIndex,IDBObjectStore])}L(e=>({...e,get(n,t,r){return p(n,t)?K:e.get(n,t,r)},has(n,t){return p(n,t)||e.has(n,t)}}));const S="images-db",f="images",R=e=>typeof e=="string"?parseInt(e.replace(/\D/g,""))||1:e||1,$=async()=>new Promise((e,n)=>{const t=indexedDB.open(S);t.onsuccess=()=>{const r=t.result.version;t.result.close(),e(r)},t.onerror=()=>n(t.error),t.onupgradeneeded=r=>e(r.oldVersion||0)}),_=async e=>v(S,e,{upgrade(n){n.objectStoreNames.contains(f)||n.createObjectStore(f)}}),b=async e=>{const n=R(e),t=await $(),r=()=>_(n);return{closeDB:async()=>{(await r()).close()},setImage:async(a,s)=>{if(n===t)return;await(await r()).put(f,s,a)},getImage:async a=>(await r()).get(f,a),version:n,oldVersion:t}},z={install(e){e.config.globalProperties.$imageDB=b,e.provide("$imageDB",b)}};exports.imageDB=b;exports.imageDBPlugin=z;
