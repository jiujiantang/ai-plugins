window._lib_pay=(function(){function l(e){return e===""?"":e.slice(0,1)==="/"?e:"/"+e}function p(e=""){return window.location.origin.indexOf("localhost")!==-1||window.location.origin.indexOf("dybzp")!==-1?"http://localhost.3d66.com:8888"+l(e):window.location.origin.indexOf("dev")!==-1?"http://service.dev.3d66.com"+l(e):window.location.origin.indexOf("test")!==-1||window.location.origin.indexOf("dybzp")!==-1?"https://service_test.3d66.com"+l(e):"https://service.3d66.com"+l(e)}let r=null;function u(e,n){$("#_qrcode").html(""),$(".pop_pay .ref .past").text("").addClass("loading").show();let a=JSON.stringify(e);$.ajax({url:p("/payment/do_payment"),type:"post",data:{data:a},xhrFields:{withCredentials:!0},success:function(i){if(i.status===1){switch(parseInt(e.cz_type)){case 0:s(i.data.qrcode,"wechat");break;case 1:s(i.data,"ali");break;case 3:$("#_paypalSubmit").html(i.data.payurl);break;default:$("#_qrcode").empty(),s(i.data.qrcode,"wechat");break}f(i.data.jkma,e.order_type,n,parseInt(e.cz_type)),$(".pop_pay .ref .past").removeClass("loading").hide()}else window.easyPop.open({type:"toast",content:i.msg}),$(".pop_pay .ref .past").removeClass("loading").html('<p style="width: 100%;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);line-height: 20px; cursor: pointer" id="_userDefine_cover">二维码已失效<br>点击刷新</p>').show(),$("#_userDefine_cover").one("click",function(){$("#_payBtn li.active").trigger("click")})}})}function s(e,n){let a=navigator.userAgent.toLowerCase();a.indexOf("msie")>-1&&a.match(/msie ([\d.]+)/)[1];const t=$("#_qrcode");switch(n){case"ali":t.html(""),e.unionPay?setTimeout(function(){t.qrcode({width:120,height:120,text:e.qrcode})},100):document.getElementById("iframeid")||t.append('<iframe id="iframeid" src="'.concat(e.payurl,'" width="120" height="120" frameborder="0" scrolling="no"></iframe>'));break;case"wechat":t.html(""),t.qrcode({width:120,height:120,text:e});break}}var o=o||{};o.getVersionId=function(){var e=0;try{e=window.external.LiuYunKuVersionId}catch(n){console.log("获取失败："+n)}return Number(e)},o.paymentSuccessCallback=function(e){var n={handler:typeof window.external=="object"?window.external:{},paymentSuccessCallback:function(a){var i=!1,t;try{a=typeof a<"u"?a:"",this.handler.paymentSuccessCallback(a)}catch(c){i=!0,t=c}return new Promise(function(c,d){i?d(t):c()})}};n.paymentSuccessCallback(e).catch(function(a){console.log("方法调用失败："+a)})},o.refAccountCallback=function(){try{var e={handler:typeof window.external=="object"?window.external:{},refAccountCallback:function(n){"refAccountCallback"in this.handler&&this.handler.refAccountCallback(n)}};window.external.refAccountCallback()}catch(n){console.log("方法调用失败")}};function f(e,n,a,i){clearInterval(r),r=setInterval(function(){$(".pop_pay").is(":visible")||clearInterval(r),$.ajax({url:p("/pay/check_pay"),type:"post",data:{service:"ll.order.check",jkma:e,cz_channel:n},xhrFields:{withCredentials:!0},success:function(t){if(t.status===200){a(),clearInterval(r);var c=window.location.origin.indexOf("test")>-1,d=c?660:1409;o.getVersionId()>d?o.paymentSuccessCallback(t.data):o.refAccountCallback()}else t.status===401&&i!==3&&($(".pop_pay .ref .past").html('<p style="width: 100%;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);line-height: 20px; cursor: pointer" id="_userDefine_cover">二维码已失效<br>点击刷新</p>').show(),$("#_userDefine_cover").one("click",function(){$("#_payBtn li.active").trigger("click")}),clearInterval(r))},error:function(t){console.log("err:",t)}})},2e3)}function h(){$(".pop_pay .ref .past").hide(),clearInterval(r)}return{paymentFcun:u,clearTabCheckPay:h}})();
//# sourceMappingURL=Pay-CQ7G_184.js.map
